<!-- test.html -->
<!doctype html>
<html>
<head><meta charset="utf-8"><title>WS Test</title></head>
<body>
<h3>WebSocket Test</h3>
<script>
    // 1. åˆ›å»ºè¿žæŽ¥
    const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6";
    const ws = new WebSocket("ws://localhost:8080/ws/chat", ["Bearer_" + token]);

    // 2. è¿žæŽ¥å»ºç«‹æ—¶è§¦å‘
    ws.onopen = (event) => {
        console.log("âœ… WebSocket opened", event);
        // å¯ä»¥ç«‹åˆ»
        ws.send(JSON.stringify({userId: "462", msg: "Hello from browser"}));
    };

    // 3. æŽ¥æ”¶æ¶ˆæ¯
    ws.onmessage = (event) => {
        console.log("ðŸ“© Message received:", event.data);
        // å¦‚æžœæœåŠ¡ç«¯å‘æ¥ JSON å­—ç¬¦ä¸²ï¼Œå¯ parseï¼š
        try {
            const obj = JSON.parse(event.data);
            console.log("â†’ parsed:", obj);
        } catch (e) {
            console.log("â†’ plain text:", event.data);
        }
    };

    // 4. é”™è¯¯å¤„ç†
    ws.onerror = (err) => {
        console.error("âŒ WebSocket error:", err);
    };

    // 5. è¿žæŽ¥å…³é—­
    ws.onclose = (ev) => {
        console.log("ðŸ”’ Closed:", ev.code, ev.reason);
    };

    if (ws.readyState === WebSocket.CLOSED){
        ws.onopen();
    }
    // 6. ä¸»åŠ¨å…³é—­ï¼ˆç¤ºä¾‹ï¼‰
    // setTimeout(() => ws.close(1000, "bye"), 10000);
</script>
</body>
</html>
