<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chatroom.user.dao.UserMapper">
    <insert id="insertUser">
        INSERT INTO user_info(user_id, user_name, avatart_url, password, email, status)
        VALUES (#{userPKId}, #{userName}, #{avatarUrl}, #{password}, #{email}, #{status})
    </insert>
<!--    将外部使用的userId 转换为内部通用的 PKid-->
    <select id="selectPKIdByUserId">
        SELECT id FROM user_info WHERE user_id = #{userPKId}
    </select>
<!--    将内部PKid转换为外部userId-->
    <select id="selectUserIdByPKId">
        SELECT user_id FROM user_info WHERE id = #{id}
    </select>
<!-- 程序内部通过PKid进行一系列操作-->
    <select id="selectUserByPKId">
        SELECT * FROM user_info WHERE id = #{id}
    </select>
<!--    通过userId查找用户 | 对外查询入口-->
    <select id="selectUserByUserId">
        SELECT * FROM user_info WHERE user_id = #{userPKId}
    </select>

    <select id="selectUserByName">
        SELECT * FROM user_info WHERE user_name = #{userName}
    </select>

    <update id="updateUserStatus">
        UPDATE user_info SET status = #{status} WHERE id = #{id}
    </update>

    <update id="updateUserInfo">
        UPDATE user_info SET user_name = #{userName}, avatar_url = #{avatarUrl}, email = #{email}, user_id = #{userPKId} WHERE id = #{id}
    </update>

    <select id="getUserRoles">
        SELECT r.role_code FROM user_role ur JOIN role r ON ur.role_id = r.id WHERE ur.id = #{id}
    </select>

    <insert id="insertUserRoleTable">
        INSERT INTO user_role(user_id, role_id) VALUES (#{user_id}, #{role_id})
    </insert>

    <select id="getRoleIdByCode">
        SELECT id FROM role WHERE role_code = #{role_code}
    </select>
    <select id="getRoleCodeById">
        SELECT role_code FROM role WHERE id = #{id}
    </select>

    <select id="getRoleIdsByUserId">
        SELECT role_id FROM user_role WHERE user_id = #{user_id}
    </select>
</mapper>